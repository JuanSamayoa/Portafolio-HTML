---
import { getBadgeClasses } from "../utils/badgeUtils";

// Simplificamos las interfaces para reducir complejidad
interface Props {
  date: string;
  title: string;
  company?: string;
  location?: string;
  description: string | string[];
  badges?: Array<{ text: string; color?: string }>;
  isActive?: boolean;
}

const {
  date,
  title,
  company,
  location,
  description,
  badges = [],
  isActive = false,
} = Astro.props;

const descArray = Array.isArray(description) ? description : [description];
---

<li
  class="mb-12 ms-6 group transition-all duration-500 ease-out hover:translate-x-3 relative"
>
  <!-- Punto conector animado -->
  <div class="absolute -left-10 top-2 flex items-center justify-center">
    <div
      class="w-4 h-4 bg-gradient-to-br from-primary to-accent rounded-full shadow-lg group-hover:shadow-xl transition-all duration-300 group-hover:scale-125 relative"
    >
      <!-- Anillo de pulso -->
      <div
        class="absolute inset-0 w-4 h-4 bg-primary rounded-full animate-ping-slow opacity-30"
      >
      </div>
      <!-- Punto interno -->
      <div class="absolute inset-1 bg-white dark:bg-gray-900 rounded-full">
      </div>
    </div>
  </div>

  <!-- Conector vertical animado -->
  <div
    class="absolute -left-8 top-6 w-0.5 h-8 bg-gradient-to-b from-primary/50 to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-500"
  >
  </div>

  <div
    class="bg-gradient-to-br from-white/80 to-white/60 dark:from-gray-800/80 dark:to-gray-900/60 backdrop-blur-sm rounded-xl p-6 shadow-lg hover:shadow-2xl transition-all duration-500 border border-gray-200/50 dark:border-gray-700/50 group-hover:border-primary/30 dark:group-hover:border-primary/40 transform group-hover:scale-[1.02]"
  >
    <time
      class="mb-2 text-sm font-semibold leading-none text-primary dark:text-primary-300 bg-primary/10 dark:bg-primary/20 px-3 py-1 rounded-full inline-block"
      datetime={date.replace(/\s/g, "")}
    >
      {date}
    </time>

    <h3
      class="text-xl font-bold text-gray-900 dark:text-white transition-colors duration-300 group-hover:text-primary dark:group-hover:text-primary/90 flex flex-wrap items-center gap-2 mb-2"
    >
      {title}
      {
        isActive && (
          <span class="flex items-center text-xs font-medium text-primary dark:text-primary-300 bg-primary/10 dark:bg-primary/20 px-2 py-1 rounded-full">
            <span class="relative flex h-2 w-2 me-2">
              <span class="animate-ping-slow absolute inline-flex h-full w-full rounded-full bg-primary opacity-60" />
              <span class="relative inline-flex rounded-full h-2 w-2 bg-primary" />
            </span>
            Actual
          </span>
        )
      }
    </h3>

    {
      (company || location) && (
        <div class="flex items-center gap-2 mb-3">
          <div class="w-8 h-8 bg-gradient-to-br from-primary/20 to-accent/20 rounded-lg flex items-center justify-center">
            <svg
              class="w-4 h-4 text-primary"
              fill="none"
              stroke="currentColor"
              viewBox="0 0 24 24"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"
              />
            </svg>
          </div>
          <p class="text-sm text-gray-600 dark:text-gray-400">
            {company && (
              <span class="font-semibold text-gray-800 dark:text-gray-200">
                {company}
              </span>
            )}
            {company && location && <span class="mx-2 text-primary/50">•</span>}
            {location && (
              <span class="text-gray-500 dark:text-gray-400">{location}</span>
            )}
          </p>
        </div>
      )
    }

    {
      badges.length > 0 && (
        <div class="flex flex-wrap gap-2 mt-3 mb-4">
          {badges.map((badge) => (
            <span
              class={`${getBadgeClasses(badge.text)} transition-all duration-300 hover:scale-105 hover:shadow-md`}
            >
              {badge.text}
            </span>
          ))}
        </div>
      )
    }

    <div class="space-y-3">
      {
        descArray.map((paragraph) => (
          <p class="text-base font-normal text-gray-600 dark:text-gray-300 leading-relaxed">
            {paragraph}
          </p>
        ))
      }
    </div>
  </div>
</li>

<style>
  /* Animación personalizada más suave para el indicador "Actual" */
  @keyframes ping-slow {
    0% {
      transform: scale(1);
      opacity: 0.8;
    }
    50% {
      transform: scale(1.5);
      opacity: 0.4;
    }
    100% {
      transform: scale(2);
      opacity: 0;
    }
  }

  .animate-ping-slow {
    animation: ping-slow 3s cubic-bezier(0, 0, 0.2, 1) infinite;
  }

  /* Animación contenida que no afecta otros elementos */
  @keyframes ping-contained {
    0%,
    100% {
      transform: scale(1);
      opacity: 0;
    }
    50% {
      transform: scale(1.8);
      opacity: 0.3;
    }
  }

  .animate-ping-contained {
    animation: ping-contained 3s ease-in-out infinite;
    background-color: var(--color-primary);
    z-index: -1;
    pointer-events: none;
  }

  /* Mejoras para elementos interactivos SOLO dentro del componente de experiencia */
  .experience-group:hover .experience-scale-125 {
    transform: scale(1.25);
  }

  .experience-group:hover .experience-translate-x-3 {
    transform: translateX(12px);
  }

  /* Transiciones suaves solo para elementos interactivos específicos en este componente */
  .experience-group a,
  .experience-group button,
  .experience-group .certification-card,
  .experience-group .badge {
    transition-property: transform, box-shadow, opacity;
    transition-timing-function: cubic-bezier(0.4, 0, 0.2, 1);
  }

  /* Mejoras responsive */
  @media (max-width: 768px) {
    .group:hover .group-hover\:translate-x-3 {
      transform: translateX(8px);
    }

    .group:hover .group-hover\:scale-125 {
      transform: scale(1.1);
    }
  }

  @media (prefers-reduced-motion) {
    .animate-ping-contained {
      animation: none;
    }

    .animate-ping-slow {
      animation: none;
    }
  }
</style>
