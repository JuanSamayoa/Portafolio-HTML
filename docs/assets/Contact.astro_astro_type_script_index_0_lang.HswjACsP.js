function v(e){const t=/^[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/;return!e||e.trim().length===0||e.length>254?!1:t.test(e.trim())}function b(e){return!e||e.trim().length===0||e.trim().length<2||e.trim().length>50?!1:/^[a-zA-ZÀ-ÿĀ-žА-я\s\-']+$/.test(e.trim())}function T(e){return!(!e||e.trim().length===0||e.trim().length<5||e.trim().length>100)}function A(e){return!(!e||e.trim().length===0||e.trim().length<10||e.trim().length>1e3)}function l(e){return e?e.trim().replace(/[<>]/g,"").replace(/javascript:/gi,"").replace(/on\w+=/gi,""):""}function E(e){const t=[],n={name:l(e.name),email:l(e.email),subject:l(e.subject),message:l(e.message)};return b(n.name)||t.push("El nombre debe tener entre 2 y 50 caracteres y contener solo letras válidas."),v(n.email)||t.push("Por favor, ingresa un email válido."),T(n.subject)||t.push("El asunto debe tener entre 5 y 100 caracteres."),A(n.message)||t.push("El mensaje debe tener entre 10 y 1000 caracteres."),{isValid:t.length===0,errors:t}}function w(e,t){let n;return(...a)=>{clearTimeout(n),n=setTimeout(()=>e(...a),t)}}class M{attempts=new Map;maxAttempts;windowMs;constructor(t=5,n=6e4){this.maxAttempts=t,this.windowMs=n}canAttempt(t){const n=Date.now(),r=(this.attempts.get(t)||[]).filter(c=>n-c<this.windowMs);return r.length>=this.maxAttempts?!1:(r.push(n),this.attempts.set(t,r),!0)}getRemainingTime(t){const n=this.attempts.get(t)||[];if(n.length===0)return 0;const a=Math.min(...n),r=this.windowMs-(Date.now()-a);return Math.max(0,r)}}const u={RATE_LIMIT:{MAX_ATTEMPTS:5,WINDOW_MS:6e4}},g=new M(u.RATE_LIMIT.MAX_ATTEMPTS,u.RATE_LIMIT.WINDOW_MS),o=document.getElementById("contact-form"),i=document.getElementById("contact-submit"),h=document.getElementById("contact-success"),d=document.getElementById("contact-error");function m(e){d.innerHTML=`
            <div class="space-y-1">
              <div class="font-medium">Por favor, corrige los siguientes errores:</div>
              <ul class="text-sm space-y-1">
                ${e.map(t=>`<li>• ${t}</li>`).join("")}
              </ul>
            </div>
          `,d.classList.remove("hidden")}function f(e){const t=e.value.trim();e.classList.remove("border-red-500","border-green-500");let n=!1;switch(e.name){case"name":n=t.length>=2&&t.length<=50;break;case"email":n=/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(t)&&t.length<=254;break;case"subject":n=t.length>=5&&t.length<=100;break;case"message":n=t.length>=10&&t.length<=1e3;break}return e.classList.add(n?"border-green-500":"border-red-500"),n}const y=w(e=>{f(e)},300);if(o){const e=o.querySelectorAll("input, textarea");e.forEach(t=>{t.addEventListener("input",()=>y(t)),t.addEventListener("blur",()=>f(t))}),o.addEventListener("submit",async t=>{t.preventDefault();const n="contact-form";if(!g.canAttempt(n)){const s=Math.ceil(g.getRemainingTime(n)/1e3);m([`Has superado el límite de envíos. Intenta de nuevo en ${s} segundos.`]);return}i.disabled=!0,i.textContent="Enviando...",h.classList.add("hidden"),d.classList.add("hidden");const a=new FormData(o),r={name:a.get("name"),email:a.get("email"),subject:a.get("subject"),message:a.get("message")},c=E(r);if(!c.isValid){m(c.errors),i.disabled=!1,i.textContent="Enviar Mensaje";return}try{const s=await fetch("https://my-wedding-database.vercel.app/api/portafolio/contact",{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify(r)});if(!s.ok)throw new Error(`HTTP ${s.status}: ${s.statusText}`);h.classList.remove("hidden"),o.reset(),e.forEach(p=>{p.classList.remove("border-red-500","border-green-500")})}catch(s){console.error("Error al enviar formulario:",s),m(["No se pudo enviar el mensaje. Por favor, intenta de nuevo más tarde.","Si el problema persiste, puedes contactarme directamente por email."])}finally{i.disabled=!1,i.textContent="Enviar Mensaje"}})}
